<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="generator" content="HTML Tidy for HTML5 for Linux version 5.6.0">
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect">
    <link as="style"
        href="https://fonts.googleapis.com/css2?display=swap&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800"
        onload="this.rel='stylesheet'" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/theme.css">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <title>Bookme Community</title>
    <link href="data:image/x-icon;base64," rel="icon" type="image/x-icon">
</head>
  <style>
    :root {
      --primary: #2badee;
      --bg-light: #f6f7f8;
      --bg-dark: #101c22;
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background-color: var(--bg-light);
      color: #333;
    }

    body.dark-mode {
      background-color: var(--bg-dark);
      color: #ddd;
    }

    .navbar {
      border-bottom: 1px solid rgba(0,0,0,0.1);
      background-color: var(--bg-light);
    }

    .dark-mode .navbar {
      background-color: var(--bg-dark);
      border-color: rgba(255,255,255,0.1);
    }

    .nav-link.active {
      color: var(--primary) !important;
      font-weight: 700;
    }

    .card {
      border: none;
      border-radius: 1rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      background-color: #fff;
    }

    .dark-mode .card {
      background-color: rgba(255,255,255,0.05);
      border-color: rgba(255,255,255,0.15);
    }

    .post-header img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
    }

    .post-actions button {
      background: none;
      border: none;
      color: #666;
      font-weight: 500;
    }

    .post-actions button:hover {
      color: var(--primary);
    }

    footer {
      border-top: 1px solid rgba(0,0,0,0.1);
      background-color: var(--bg-light);
    }

    .dark-mode footer {
      background-color: var(--bg-dark);
      border-color: rgba(255,255,255,0.1);
    }

    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
    }
    .btn-primary:hover {
      background-color: #1b8ecb;
    }
  </style>
<body class="bg-light text-dark">
    <div class="d-flex flex-column min-vh-100">
        <header class="w-100 site-header">
            <div class="container d-flex align-items-center justify-content-between py-3">
              <div class="d-flex align-items-center">
                <div class="me-2" style="width:40px;height:40px;color:var(--bs-primary);">
                  <span class="material-symbols-outlined fs-3 text-primary">book</span>
                </div>
                <h1 class="h5 mb-0 ms-2"><a href="{{ url_for('dashboard.index') }}" class="text-decoration-none text-reset">BookMe</a></h1>
              </div>
              <nav class="nav-centered d-none d-md-flex align-items-center gap-2">
                <a class="btn btn-sm btn-light rounded-pill" href="{{ url_for('dashboard.index') }}">Home</a>
                <a class="btn btn-sm btn-light rounded-pill" href="{{ url_for('study.index') }}">Study</a>
                <a class="btn btn-sm btn-primary rounded-pill text-white" href="{{ url_for('community.index') }}">Community</a>
                <a class="btn btn-sm btn-light rounded-pill" href="{{ url_for('challenges.index') }}">Challenge</a>
              </nav>
              <div class="d-none d-md-flex align-items-center header-actions">
                <button type="button" class="btn btn-link text-muted p-0" aria-label="Notifications" title="Notifications">
                  <span class="material-symbols-outlined">notifications</span>
                </button>
                <div class="dropdown">
                  <a class="btn btn-link text-muted p-0 dropdown-toggle" href="{{ url_for('profile.index') }}" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Profile" title="Profile">
                    <span class="material-symbols-outlined fs-3">account_circle</span>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                    <li><h6 class="dropdown-header">Account</h6></li>
                    <li><a class="dropdown-item" href="{{ url_for('profile.index') }}">Profile & Settings</a></li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                      <form method="POST" action="{{ url_for('auth.logout') }}" class="m-0">
                        <button type="submit" class="dropdown-item">Log out</button>
                      </form>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
        </header>
        <main class="flex-grow-1">
            <div class="container my-5">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <h2 class="h3 mb-0">Community</h2><small class="text-muted">Connect with others</small>
                </div>

        <ul class="nav nav-tabs mb-4" role="tablist">
                    <!--<li class="nav-item" role="presentation"><a class="nav-link" href="index.html" id="notes-tab" aria-controls="notes"
                      aria-selected="false">Notes</a></button></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" href="friends.html" id="friends-tab"
                            aria-controls="friends" aria-selected="false">Friends</a></button></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" href="feed.html" id="feed-tab" aria-controls="feed" 
                      aria-selected="false">Feed</a></button></li> -->
                      <li class="nav-item" role="presentation"><a class="nav-link" href="{{ url_for('community.index') }}" id="notes-tab"
                        data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab" aria-controls="notes"
                            aria-selected="false">Notes</a></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" href="{{ url_for('community.friends') }}" id="friends-tab" 
                      data-bs-toggle="tab" data-bs-target="#friends" type="button" role="tab" aria-controls="friends" aria-selected="false">Friends</a></li>
                    <li class="nav-item" role="presentation"><a class="nav-link active" href="{{ url_for('community.feed')}}" id="feed-tab" 
                      data-bs-toggle="tab" data-bs-target="#feed" type="button" role="tab" aria-controls="feed" aria-selected="true">Feed</button></li> 

                      <!-- <li class="nav-item" role="presentation"><button class="nav-link active" id="notes-tab"
                            data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab" aria-controls="notes"
                            aria-selected="true">Notes</button></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" href="{{ url_for('community.friends') }}" id="friends-tab" 
                      data-bs-toggle="tab" data-bs-target="#friends" type="button" role="tab" aria-controls="friends" aria-selected="false">Friends</a></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" href="{{ url_for('feed.index') }}" id="feed-tab" 
                      data-bs-toggle="tab" data-bs-target="#feed" type="button" role="tab" aria-controls="feed" aria-selected="false">Feed</a></li>  -->


                </ul>


<!-- Feed Section -->
  <main class="container my-5">
    <h2 class="fw-bold display-6 mb-4">Feed</h2>

    <!-- Post Input -->
    <div class="card p-4 mb-5">
      <div class="d-flex align-items-center mb-3">
        <img src="https://i.pravatar.cc/60?img=8" class="rounded-circle me-3" width="50" height="50" alt="user">
        <input id="postText" type="text" class="form-control rounded-pill" placeholder="Share a note, thought, or photo...">
      </div>
      <input type="text" id="postImage" placeholder = "Image URL (optional)" accept="image/*" class="form-control mb-3">
      <div class="d-flex justify-content-between">
        <button class="btn btn-light btn-sm">üì∏ Add Photo</button>  
        <button class="btn btn-primary btn-sm" onclick="createPost()">Post</button>

      </div>
    </div>


    <div id="feedPosts"></div>

    <h2>Share an image</h2>
<form action="/api/community/posts/image" method="POST" enctype="multipart/form-data">
  <input type="file" name="image" accept="image/*" required>
  <button type="submit">Upload</button>
</form>

<h2 class="mb-4">Share a post</h2>
<form action="/api/feed/posts/image" method="POST" enctype="multipart/form-data" class="mb-5">
  <div class="mb-3">
    <textarea name="content" class="form-control" rows="3" placeholder="Write something..." required></textarea>
  </div>
  <div class="mb-3">
    <input type="file" name="image" accept="image/*" class="form-control">
  </div>
  <button type="submit" class="btn btn-primary">Post</button>
</form>


    {% for post in posts %}
    <div class="card p-4 mb-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h6 class="mb-0 fw-bold">{{ post.author }}</h6>
    </div>
  </div>
  <p>{{ post.content }}</p>

  {% if post.image %}
    <img src="{{ url_for('static', filename='uploads/' + post.image) }}"
         alt="Post Image"
         class="img-fluid rounded mb-3"
         style="max-width: 300px; border-radius:10px;">
  {% endif %}

  <div class="d-flex justify-content-between text-muted">
    <button>üëç Like</button>
    <button>üí¨ Comment</button>
    <button>‚ÜóÔ∏è Share</button>
  </div>
</div>

  <div class="post">
    <p><strong>{{ post.author }}</strong></p>
    <p>{{ post.content }}</p>

  </div>
    {% endfor %}

     <!-- Post 1 -->
    <div class="card p-4 mb-4">
      <div class="d-flex justify-content-between align-items-center mb-3 post-header">
        <div class="d-flex align-items-center gap-3">
          <img src="https://i.pravatar.cc/60?img=5" alt="profile">
          <div>
            <h6 class="mb-0 fw-bold">Alice Chen</h6>
            <small class="text-muted">2 hours ago</small>
          </div>
        </div>
        <div>
          <button class="btn btn-outline-primary btn-sm me-2">Follow</button>
          <button class="btn btn-outline-secondary btn-sm">View Profile</button>
        </div>
      </div>
      <p>Studying machine learning today! Here‚Äôs a visual summary of the gradient descent process üß†üìâ</p>
      <img src="https://www.kdnuggets.com/wp-content/uploads/gradient-descent.jpg" class="img-fluid rounded mb-3" alt="post content">
      <div class="d-flex justify-content-between text-muted post-actions">
        <button>üëç Like</button>
        <button>üí¨ Comment</button>
        <button>‚ÜóÔ∏è Share</button>
      </div>
    </div>

    <!-- Post 2 -->
    <div class="card p-4 mb-4">
      <div class="d-flex justify-content-between align-items-center mb-3 post-header">
        <div class="d-flex align-items-center gap-3">
          <img src="https://i.pravatar.cc/60?img=12" alt="profile">
          <div>
            <h6 class="mb-0 fw-bold">James Miller</h6>
            <small class="text-muted">5 hours ago</small>
          </div>
        </div>
        <div>
          <button class="btn btn-outline-primary btn-sm me-2">Add Friend</button>
          <button class="btn btn-outline-secondary btn-sm">View Profile</button>
        </div>
      </div>
      <p>Here‚Äôs my summary of the <b>Photosynthesis process</b> üåø ‚Äî feel free to save and use it for your notes!</p>
      <img src="https://upload.wikimedia.org/wikipedia/commons/3/3b/Photosynthesis_en.svg" class="img-fluid rounded mb-3" alt="notes">
      <div class="d-flex justify-content-between text-muted post-actions">
        <button>üëç Like</button>
        <button>üí¨ Comment</button>
        <button>‚ÜóÔ∏è Share</button>
      </div>
    </div>

    <!-- Post 3 -->
    <div class="card p-4 mb-4">
      <div class="d-flex justify-content-between align-items-center mb-3 post-header">
        <div class="d-flex align-items-center gap-3">
          <img src="https://i.pravatar.cc/60?img=16" alt="profile">
          <div>
            <h6 class="mb-0 fw-bold">Sophia Nguyen</h6>
            <small class="text-muted">Yesterday</small>
          </div>
        </div>
        <div>
          <button class="btn btn-outline-primary btn-sm me-2">Follow</button>
          <button class="btn btn-outline-secondary btn-sm">View Profile</button>
        </div>
      </div>
      <p>Had a group study session today on Calculus ‚Äî amazing collaboration and focus! Here are my notes üßÆ</p>
      <img src="https://images.unsplash.com/photo-1503676260728-1c00da094a0b?auto=format&fit=crop&w=800&q=80" class="img-fluid rounded mb-3" alt="study photo">
      <div class="d-flex justify-content-between text-muted post-actions">
        <button>üëç Like</button>
        <button>üí¨ Comment</button>
        <button>‚ÜóÔ∏è Share</button>
      </div>
    </div>

  </main>

    <!-- Comment Modal -->
<div class="modal fade" id="commentModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Comments</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div id="commentList"></div>
      </div>
 
      <script src="https://cdn.jsdelivr.net/npm/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
// Simple nav highlight (optional)
document.addEventListener('DOMContentLoaded', () => {
  try {
    const header = document.querySelector('header');
    const links = header ? Array.from(header.querySelectorAll('a[href]')) : [];
    const parts = location.pathname.split('/').filter(Boolean);
    const currentSlug = parts[0] || 'home';
    links.forEach(a => {
      try {
        const url = new URL(a.getAttribute('href'), location.origin);
        const linkParts = url.pathname.split('/').filter(Boolean);
        const linkSlug = linkParts[0] || 'home';
        a.classList.remove('active');
        if (linkSlug === currentSlug) a.classList.add('active');
      } catch {}
    });
  } catch {}
});

function formatPostTime(timestamp) {
  if (!timestamp) return 'Just now';
  const postDate = new Date(timestamp);
  const now = new Date();
  const diffMs = now - postDate;
  const diffSec = Math.floor(diffMs / 1000);
  const diffMin = Math.floor(diffSec / 60);
  const diffHour = Math.floor(diffMin / 60);
  const diffDay = Math.floor(diffHour / 24);
  if (diffSec < 60) return 'Just now';
  if (diffMin < 60) return `${diffMin} minute${diffMin === 1 ? '' : 's'} ago`;
  if (diffHour < 24) return `${diffHour} hour${diffHour === 1 ? '' : 's'} ago`;
  if (diffDay < 7) return `${diffDay} day${diffDay === 1 ? '' : 's'} ago`;
  return postDate.toLocaleDateString();
}

function readFileAsDataURL(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

async function createPost() {
  const postInput = document.getElementById('postText');
  const imageInput = document.getElementById('postImage');
  const text = (postInput?.value || '').trim();
  if (!text && !(imageInput && imageInput.files && imageInput.files.length)) return;

  let image = null;
  if (imageInput && imageInput.files && imageInput.files[0]) {
    try {
      image = await readFileAsDataURL(imageInput.files[0]);
    } catch (e) {
      // ignore image read errors
    }
  }

  try {
    const response = await fetch('/feed/api/feed/posts', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text, image })
    });
    if (response.ok) {
      if (postInput) postInput.value = '';
      if (imageInput) imageInput.value = '';
      loadFeed();
    } else {
      alert('Failed to create post. Please try again.');
    }
  } catch {
    alert('Network error. Please try again.');
  }
}

let activePostId = null;

async function openComments(postId) {
  activePostId = postId;
  try {
    const res = await fetch(`/feed/api/feed/posts/${postId}`);
    if (!res.ok) throw new Error();
    const post = await res.json();
    const list = document.getElementById('commentList');
    list.innerHTML = '';
    const comments = post.comments || [];
    if (!comments.length) {
      list.innerHTML = '<div class="text-muted">No comments yet.</div>';
    } else {
      comments.forEach(c => {
        const div = document.createElement('div');
        div.className = 'border rounded p-2 mb-2';
        div.innerHTML = `<strong>${c.author}:</strong><br><span>${c.text}</span><br><small class=\"text-muted\">${new Date(c.timestamp).toLocaleString()}</small>`;
        list.appendChild(div);
      });
    }
    const modalEl = document.getElementById('commentModal');
    if (modalEl) new bootstrap.Modal(modalEl).show();
  } catch {
    alert('Failed to load comments.');
  }
}

async function submitComment() {
  if (!activePostId) return;
  const inputEl = document.getElementById('commentInput');
  const text = (inputEl?.value || '').trim();
  if (!text) return;
  try {
    const res = await fetch(`/feed/api/feed/posts/${activePostId}/comments`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text })
    });
    if (res.ok) {
      inputEl.value = '';
      openComments(activePostId);
      loadFeed();
    } else {
      alert('Failed to submit comment. Please try again.');
    }
  } catch {
    alert('Network error. Please try again.');
  }
}

async function likePost(postId) {
  await fetch(`/feed/api/feed/posts/${postId}/like`, { method: 'POST' });
  loadFeed();
}

async function loadFeed() {
  try {
    const res = await fetch('/feed/api/feed/posts');
    const posts = await res.json();
    const container = document.getElementById('feedPosts');
    container.innerHTML = '';
    posts.forEach(post => {
      const card = document.createElement('div');
      card.className = 'card p-4 mb-4';

      const header = document.createElement('div');
      header.className = 'd-flex justify-content-between align-items-center mb-3 post-header';
      const left = document.createElement('div');
      left.className = 'd-flex align-items-center gap-3';
      const avatar = document.createElement('img');
      avatar.src = `https://i.pravatar.cc/60?u=${post.author}`;
      avatar.alt = 'profile';
      left.appendChild(avatar);
      const info = document.createElement('div');
      const name = document.createElement('h6');
      name.className = 'mb-0 fw-bold';
      name.textContent = post.author;
      const time = document.createElement('small');
      time.className = 'text-muted';
      time.textContent = formatPostTime(post.timestamp);
      info.appendChild(name);
      info.appendChild(time);
      left.appendChild(info);
      header.appendChild(left);
      card.appendChild(header);

      if (post.text) {
        const p = document.createElement('p');
        p.textContent = post.text;
        card.appendChild(p);
      }
      if (post.image) {
        const im = document.createElement('img');
        im.src = post.image;
        im.className = 'img-fluid rounded mb-3';
        card.appendChild(im);
      }

      const actions = document.createElement('div');
      actions.className = 'd-flex justify-content-between text-muted post-actions';
      const likeBtn = document.createElement('button');
      likeBtn.textContent = `üëç ${post.likes || 0}`;
      likeBtn.onclick = () => likePost(post._id);
      const commentBtn = document.createElement('button');
      commentBtn.textContent = `üí¨ ${(post.comments || []).length}`;
      commentBtn.onclick = () => openComments(post._id);
      const shareBtn = document.createElement('button');
      shareBtn.textContent = '‚ÜóÔ∏è Share';
      actions.appendChild(likeBtn);
      actions.appendChild(commentBtn);
      actions.appendChild(shareBtn);
      card.appendChild(actions);

      container.appendChild(card);
    });
  } catch {}
}

document.addEventListener('DOMContentLoaded', loadFeed);
    </script>
  </body>

</html> 
