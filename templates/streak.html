<!DOCTYPE html>
<html lang="en">
  <head>
    <meta
      name="generator"
      content="HTML Tidy for HTML5 for Linux version 5.6.0"
    />
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <title>Bookme - Streak</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link rel="stylesheet" href="../static/styles-streak-theme.css" />
    <link rel="stylesheet" href="../static/styles-streak.css" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Plus Jakarta Sans", sans-serif;
      }
    </style>
  </head>
  <body class="bg-light text-dark">
    <div class="d-flex flex-column min-vh-100">
      <header class="w-100 site-header">
        <div
          class="container d-flex align-items-center justify-content-between py-3"
        >
          <div class="d-flex align-items-center">
            <div
              class="me-2"
              style="width: 40px; height: 40px; color: var(--bs-primary)"
            >
              <span class="material-symbols-outlined fs-3 text-primary"
                >book</span
              >
            </div>
            <h1 class="h5 mb-0 ms-2">
              <a
                href="{{ url_for('dashboard.index') }}"
                class="text-decoration-none text-reset"
                >BookMe</a
              >
            </h1>
          </div>
          <nav class="nav-centered d-none d-md-flex align-items-center gap-2">
            <a
              class="btn btn-sm btn-light rounded-pill"
              href="{{ url_for('dashboard.index') }}"
              >Home</a
            >
            <a
              class="btn btn-sm btn-primary rounded-pill text-white"
              href="{{ url_for('study.index') }}"
              >Study</a
            >
            <a
              class="btn btn-sm btn-light rounded-pill"
              href="{{ url_for('community.index') }}"
              >Community</a
            >
            <a
              class="btn btn-sm btn-light rounded-pill"
              href="{{ url_for('challenges.index') }}"
              >Challenge</a
            >
          </nav>
          <div class="d-none d-md-flex align-items-center header-actions">
            <button
              type="button"
              class="btn btn-link text-muted p-0"
              aria-label="Notifications"
              title="Notifications"
            >
              <span class="material-symbols-outlined">notifications</span>
            </button>
            <div class="dropdown">
              <a
                class="btn btn-link text-muted p-0 dropdown-toggle"
                href="{{ url_for('profile.index') }}"
                id="profileDropdown"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                aria-label="Profile"
                title="Profile"
              >
                <span class="material-symbols-outlined fs-3"
                  >account_circle</span
                >
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="profileDropdown"
              >
                <li><h6 class="dropdown-header">Account</h6></li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('profile.index') }}"
                    >Profile & Settings</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <form
                    method="POST"
                    action="{{ url_for('auth.logout') }}"
                    class="m-0"
                  >
                    <button type="submit" class="dropdown-item">Log out</button>
                  </form>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </header>

      <main class="container py-5">
        <div class="streak-container">
          <h2 class="fw-bold mb-3">Your Login Streak</h2>
          <div
            class="card p-3"
            data-streak="{{ studyData.streak | default(0) }}"
          >
            <div class="month-labels" id="month-labels"></div>
            <div class="d-flex gap-2">
              <div class="weekday-labels">
                <div></div>
                <div>Mon</div>
                <div></div>
                <div>Wed</div>
                <div></div>
                <div>Fri</div>
                <div></div>
              </div>
              <div class="streak-grid" id="streak-grid">
                <!-- Days will be generated by JS -->
              </div>
            </div>
          </div>
          <div class="streak-legend">
            <span class="text-muted small">No login</span>
            <div class="streak-day" data-level="0"></div>
            <div class="streak-day" data-level="1"></div>
            <span class="text-muted small">Logged in</span>
          </div>
        </div>

        <!-- gif section -->
        <div class="motivational-section text-center mt-4">
          <img
            src="https://i.pinimg.com/originals/d5/f5/ae/d5f5ae2e743118a375986e0bb292f1a2.gif"
            alt="Motivational celebration gif"
            class="motivational-gif mb-3"
          />
          <div class="motivational-message">
            <p class="h6 text-primary fw-bold mb-1">You're doing amazing!</p>
            <p class="text-muted small">
              Remember why you're doing this âœ© every small step counts toward
              your goals. Keep up the great work! ðŸŒŸ
            </p>
          </div>
        </div>
      </main>

      <footer class="d-md-none fixed-bottom bg-white border-top">
        <nav class="nav justify-content-around py-2">
          <a
            class="nav-link d-flex flex-column align-items-center text-primary fw-bold"
            href="{{ url_for('home.index') }}"
            ><span class="material-symbols-outlined fs-4">home</span>
            <small class="d-block">Home</small></a
          >
          <a
            class="nav-link d-flex flex-column align-items-center text-muted"
            href="{{ url_for('study.index') }}"
            ><span class="material-symbols-outlined fs-4">school</span>
            <small class="d-block">Study</small></a
          >
          <a
            class="nav-link d-flex flex-column align-items-center text-muted"
            href="{{ url_for('community.index') }}"
            ><span class="material-symbols-outlined fs-4">groups</span>
            <small class="d-block">Community</small></a
          >
          <a
            class="nav-link d-flex flex-column align-items-center text-muted"
            href="{{ url_for('challenges.index') }}"
            ><span class="material-symbols-outlined fs-4">emoji_events</span>
            <small class="d-block">Challenge</small></a
          >
        </nav>
      </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const grid = document.getElementById("streak-grid");
        const monthLabelsContainer = document.getElementById("month-labels");
        const today = new Date();
        const daysInGrid = 371; // 53 weeks * 7 days

        // Use server-provided streak data from data attribute
        const streakContainer = document.querySelector(
          ".streak-container .card"
        );
        const streakDays =
          parseInt(streakContainer.getAttribute("data-streak")) || 0;
        const loginDays = new Set();

        // Populate loginDays: mark consecutive days starting from today going backwards
        // Only track login days, not minutes
        for (let i = 0; i < streakDays && i < daysInGrid; i++) {
          const date = new Date();
          date.setDate(today.getDate() - i);
          // Mark this day as logged in
          loginDays.add(date.toLocaleDateString());
        }

        function getLevel(isLoggedIn) {
          // Binary: 0 = not logged in, 1 = logged in
          return isLoggedIn ? 1 : 0;
        }

        const monthLabels = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        const visibleMonths = new Array(12).fill(0);

        for (let i = 0; i < daysInGrid; i++) {
          const date = new Date();
          date.setDate(today.getDate() - (daysInGrid - 1 - i));
          const isLoggedIn = loginDays.has(date.toLocaleDateString());
          const level = getLevel(isLoggedIn);

          const day = document.createElement("div");
          day.className = "streak-day";
          day.dataset.level = level;
          day.title = isLoggedIn
            ? `${date.toDateString()}: Logged in`
            : `${date.toDateString()}: No login`;
          grid.appendChild(day);

          // For month labels
          if (date.getDate() === 1) {
            visibleMonths[date.getMonth()]++;
          }
        }

        let lastMonth = -1;
        for (let i = 0; i < 53; i++) {
          const date = new Date();
          date.setDate(today.getDate() - (daysInGrid - 1) + i * 7);
          const month = date.getMonth();
          if (month !== lastMonth) {
            const label = document.createElement("div");
            label.textContent = monthLabels[month];
            label.style.gridColumn = i + 1;
            monthLabelsContainer.appendChild(label);
            lastMonth = month;
          }
        }

        const tooltipTriggerList = [].slice.call(
          document.querySelectorAll("[title]")
        );
        tooltipTriggerList.forEach(function (tooltipTriggerEl) {
          new bootstrap.Tooltip(tooltipTriggerEl);
        });
      });
    </script>
  </body>
</html>
